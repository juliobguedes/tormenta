{"version":3,"sources":["../../src/character/characterService.js"],"names":["getFeats","char","charJson","toJSON","FeatService","getFeatsById","talentosAdicionados","feats","map","f","getCharacter","hash","cache","Character","find","charWithFeats","updateCharacter","character","findByIdAndUpdate","_id","updated","createCharacter","HashService","createHash","charObj","create"],"mappings":";;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;AAEA,IAAMA,QAAQ;AAAA,2FAAG,iBAAOC,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACPC,YAAAA,QADO,GACID,KAAI,CAACE,MAAL,EADJ;AAAA;AAAA,mBAEOC,WAAW,CAACC,YAAZ,CAAyBH,QAAQ,CAACI,mBAAlC,CAFP;;AAAA;AAEPC,YAAAA,KAFO;AAGbL,YAAAA,QAAQ,CAACI,mBAAT,GAA+BC,KAAK,CAACC,GAAN,CAAU,UAAAC,CAAC;AAAA,qBAAIA,CAAC,CAACN,MAAF,EAAJ;AAAA,aAAX,CAA/B;AAHa,6CAIND,QAJM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAARF,QAAQ;AAAA;AAAA;AAAA,GAAd;;AAOA,IAAMU,YAAY;AAAA,4FAAG,kBAAOC,IAAP,EAAaC,KAAb;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,iBACbA,KADa;AAAA;AAAA;AAAA;;AAAA,8CACCA,KADD;;AAAA;AAAA;AAAA,mBAEEC,sBAAUC,IAAV,CAAe;AAAEH,cAAAA,IAAI,EAAJA;AAAF,aAAf,CAFF;;AAAA;AAEXV,YAAAA,MAFW;AAGjB,qCAAcA,MAAd,EAAoB,WAApB;AAHiB;AAAA,mBAIWD,QAAQ,CAACC,MAAI,CAAC,CAAD,CAAL,CAJnB;;AAAA;AAIXc,YAAAA,aAJW;AAAA,8CAKVA,aALU;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAZL,YAAY;AAAA;AAAA;AAAA,GAAlB;;;;AAQA,IAAMM,eAAe;AAAA,4FAAG,kBAAOL,IAAP,EAAaM,SAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACEJ,sBAAUK,iBAAV,CAClBD,SAAS,CAACE,GADQ,EACHF,SADG,EACQ;AAAE,qBAAK;AAAP,aADR,CADF;;AAAA;AACdG,YAAAA,OADc;AAIpB,qCAAcA,OAAd,EAAuB,WAAvB;AAJoB;AAAA,mBAKQpB,QAAQ,CAACoB,OAAD,CALhB;;AAAA;AAKdL,YAAAA,aALc;AAAA,8CAMbA,aANa;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAfC,eAAe;AAAA;AAAA;AAAA,GAArB;;;;AASA,IAAMK,eAAe;AAAA,4FAAG,kBAAOJ,SAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACDK,WAAW,CAACC,UAAZ,EADC;;AAAA;AACdZ,YAAAA,IADc;AAEda,YAAAA,OAFc,mCAECP,SAFD;AAEYN,cAAAA,IAAI,EAAEA,IAAI,CAACA;AAFvB;AAAA;AAAA,mBAGDE,sBAAUY,MAAV,CAAiBD,OAAjB,CAHC;;AAAA;AAGdvB,YAAAA,MAHc;AAAA;AAAA,mBAIQD,QAAQ,CAACC,MAAD,CAJhB;;AAAA;AAIdc,YAAAA,aAJc;AAAA,8CAKbA,aALa;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAfM,eAAe;AAAA;AAAA;AAAA,GAArB","sourcesContent":["import * as HashService from '../hash/HashService';\nimport * as FeatService from '../feats/featService';\nimport Character from './Character';\nimport { checkNotFound } from  '../lib/util';\n\nconst getFeats = async (char) => {\n    const charJson = char.toJSON();\n    const feats = await FeatService.getFeatsById(charJson.talentosAdicionados);\n    charJson.talentosAdicionados = feats.map(f => f.toJSON());\n    return charJson;\n}\n\nconst getCharacter = async (hash, cache) => {\n    if (cache) return cache;\n    const char = await Character.find({ hash });\n    checkNotFound(char, 'Character');\n    const charWithFeats = await getFeats(char[0]);\n    return charWithFeats;\n};\n\nconst updateCharacter = async (hash, character) => {\n    const updated = await Character.findByIdAndUpdate(\n        character._id, character, { new: true }\n    );\n    checkNotFound(updated, 'Character');\n    const charWithFeats = await getFeats(updated);\n    return charWithFeats;\n};\n\nconst createCharacter = async (character) => {\n    const hash = await HashService.createHash();\n    const charObj = { ...character, hash: hash.hash };\n    const char = await Character.create(charObj);\n    const charWithFeats = await getFeats(char);\n    return charWithFeats;\n};\n\nexport {\n    getCharacter,\n    updateCharacter,\n    createCharacter,\n}\n"],"file":"characterService.js"}